#!/bin/bash
# YunoHost backup script for Delegacje SaaS
# shellcheck disable=SC2034

source _common.sh
source /usr/share/yunohost/helpers

# ── Backup PostgreSQL database ────────────────
ynh_psql_dump_db --database="$app" > db.sql

# ── Backup install_dir (source + build) ───────
ynh_backup --src_path="$install_dir"

# ── Backup data_dir (uploads) ─────────────────
ynh_backup --src_path="$data_dir"

# ── Backup nginx and systemd config ──────────
ynh_backup --src_path="/etc/nginx/conf.d/$domain.d/$app.conf"
ynh_backup --src_path="/etc/systemd/system/${app}-backend.service"
ynh_backup --src_path="/etc/systemd/system/${app}-frontend.service"

ynh_print_info "Backup completed."
